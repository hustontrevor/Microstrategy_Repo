DECLARE @Project as nvarchar(250);
SET @Project = 'MyProj';

WITH DIR AS (
	SELECT o.PROJECT_ID, o.OBJECT_ID, o.PARENT_ID, o.OBJECT_NAME NAME, CAST('\' AS nvarchar(max)) FOLDER
		FROM DSSMDOBJINFO o
		WHERE o.PARENT_ID = '00000000-0000-0000-0000-000000000000'
		AND o.OBJECT_NAME <> 'Managed Objects'
	UNION ALL
	SELECT o.PROJECT_ID, o.OBJECT_ID, o.PARENT_ID, o.OBJECT_NAME NAME, o2.FOLDER + o2.NAME + '\' FOLDER
		FROM DSSMDOBJINFO o
		JOIN DIR o2 ON o.PARENT_ID = o2.OBJECT_ID AND o.PROJECT_ID = o2.PROJECT_ID
		WHERE o.OBJECT_NAME <> 'System Objects'
)
,OBJTYPETEXT AS (
	SELECT 		 1 ID, 'FILTER' TYPENAME 
	UNION SELECT 2 , 'TEMPLATE'			UNION SELECT 3 , 'REPORT'			UNION SELECT 4 , 'METRIC'			UNION SELECT 6 , 'AUTOSTYLE'
	UNION SELECT 8 , 'FOLDER'			UNION SELECT 10 , 'PROMPT'			UNION SELECT 11 , 'FUNCTION'		UNION SELECT 12 , 'ATTRIBUTE' 
	UNION SELECT 13 , 'FACT'			UNION SELECT 14 , 'HIERARCHY'		UNION SELECT 15 , 'TABLE'			UNION SELECT 18 , 'SHORTCUT' 
	UNION SELECT 21 , 'ATTRIBUTE ID'	UNION SELECT 22 , 'SCHEMA'			UNION SELECT 23 , 'CELL FORMAT' 	UNION SELECT 24 , 'WAREHOUSE CATALOG' 	
	UNION SELECT 25 , 'WAREHOUSE CATALOG DEFINITION'						UNION SELECT 26 , 'TABLE COLUMN'	UNION SELECT 28 , 'PROPERTY SETS' 
	UNION SELECT 34 , 'USERS/GROUPS'	UNION SELECT 39 , 'SEARCH'			UNION SELECT 42 , 'PACKAGE'			UNION SELECT 43 , 'TRANSFORMATION'
	UNION SELECT 47 , 'CONSOLIDATION'	UNION SELECT 48 , 'DERIVED ELEMENT' UNION SELECT 52 , 'LINK'		UNION SELECT 53 , 'WAREHOUSE TABLE' 
	UNION SELECT 55 , 'DOCUMENT'		UNION SELECT 56 , 'DRILLMAP'		UNION SELECT 58 , 'SECFILTER'		UNION SELECT 60 , 'ANSWER' 
	UNION SELECT 61 , 'GRAPH STYLE'		UNION SELECT 71 , 'PALETTE' 
	--ELSE 'OTHERS'
	)
,RIGHTSTEXT AS (
	-- Convert to Binary and last 8 digits EUCDWR?B == Execute/Use/Control/Delete/Write/Read/?/Browse
	-- CUSTOM GRANT/DENY EXECUTE,USE,CONTROL,DELETE,WRITE,READ,BROWSE
	-- Grant Object 1=Grant
	SELECT 5 RIGHTS  , 'CUSTOM E0U0C0D0W0R1?1B1' RIGHTNAME	, 'CUSTOM GRANT BROWSE' ACL -- B00000011
	UNION SELECT 128 , 'CUSTOM E1U0C0D0W0R0?0B0'			, 'CUSTOM GRANT EXECUTE'-- B10000000
	UNION SELECT 194 , 'CUSTOM VIEW -READ -BROWSE'			, 'CUSTOM GRANT EXECUTE,USE' --B11000010
	UNION SELECT 198 , 'CUSTOM VIEW -BROWSE'				, 'CUSTOM GRANT EXECUTE,USE,READ'-- B11000110
	UNION SELECT 199 , 'VIEW'								, 'VIEW'-- B11000111
	UNION SELECT 207 , 'CUSTOM VIEW +WRITE'					, 'CUSTOM GRANT EXECUTE,USE,WRITE,READ,BROWSE'-- B11001111
	UNION SELECT 223 , 'MODIFY'								, 'MODIFY'-- B11011111
	UNION SELECT 255 , 'FULLCONTROL'						, 'FULLCONTROL'-- B11111111
	-- DENY OBJECT   1==DENY
	UNION SELECT 268435457 , 'CUSTOM FULLCONTROL -BROWSE'	, 'CUSTOM DENY BROWSE' -- B010000000000000000000000000001
	UNION SELECT 268435504 , 'CUSTOM E1U1C0D0W1R1?1B1'		, 'CUSTOM DENY CONTROL,DELETE' -- B010000000000000000000000110000 ?? 
	UNION SELECT 268435505 , 'CUSTOM E1U1C0D0W1R1?1B0'		, 'CUSTOM DENY CONTROL,DELETE,BROWSE' -- B010000000000000000000000110001 ??
	UNION SELECT 268435512 , 'VIEW'							, 'VIEW' -- B010000000000000000000000111000
	UNION SELECT 268435513 , 'CUSTOM VIEW -BROWSE'			, 'CUSTOM DENY CONTROL,DELETE,WRITE,BROWSE' -- B010000000000000000000000111001
	UNION SELECT 268435517 , 'CUSTOM VIEW -READ -BROWSE'	, 'CUSTOM DENY CONTROL,DELETE,WRITE,READ,BROWSE' -- B010000000000000000000000111101
	UNION SELECT 268435579 , 'CUSTOM E1U0C0D0W0R1?0B0'		, 'CUSTOM DENY USE,CONTROL,DELETE,WRITE,BROWSE' -- B010000000000000000000001111011
	UNION SELECT 268435583 , 'CUSTOM E1U0C0D0W0R0?0B0'		, 'CUSTOM DENY USE,CONTROL,DELETE,WRITE,READ,BROWSE' -- B010000000000000000000001111111
	UNION SELECT 268435711 , 'DENIEDALL'					, 'DENIEDALL'           -- B010000000000000000000011111111
	-- GRANT CHILD 
	UNION SELECT 536870913 , '-CHILD CUSTOM E0U0C0D0W0R0?0B1' ,  '' -- B100000000000000000000000000001
	UNION SELECT 536870917 , '-CHILD CUSTOM E0U0C0D0W0R1?0B1' ,  '' -- B100000000000000000000000000101
	UNION SELECT 536871110 , '-CHILD CUSTOM E1U1C0D0W0R1?1B0' ,  '' -- B100000000000000000000011000110
	UNION SELECT 536871111 , '-CHILD VIEW' ,  '' -- B100000000000000000000011000111
	UNION SELECT 536871119 , '-CHILD CUSTOM E1U1C0D0W1R1?1B1' ,  '' -- B100000000000000000000011001111
	UNION SELECT 536871135 , '-CHILD MODIFY' ,  '' -- B100000000000000000000011011111
	UNION SELECT 536871167 , '-CHILD FULLCONTROL'  ,  ''    -- B100000000000000000000011111111
	-- DENY CHILD
	UNION SELECT 805306369 , '-CHILD CUSTOM E1U1C1D1W1R1?1B0' ,  '' -- B110000000000000000000000000001
	UNION SELECT 805306400 , '-CHILD CUSTOM E1U1C0D1W1R1?1B1' ,  '' -- B110000000000000000000000100000
	UNION SELECT 805306416 , '-CHILD VIEW' ,  '' -- B110000000000000000000000110000
	UNION SELECT 805306424 , '-CHILD CUSTOM E1U1C0D0W0R1?1B1' ,  '' -- B110000000000000000000000111000
	UNION SELECT 805306425 , '-CHILD CUSTOM E1U1C0D0W0R1?1B0' ,  '' -- B110000000000000000000000111001
	UNION SELECT 805306623 , '-CHILD DENIEDALL'   ,  ''     -- B110000000000000000000011111111
	-- ??
	UNION SELECT 1610612736 , '??' , 'xxx FULLY DEFAULT? xxxxx' -- B1100000000000000000000000000000
	--ELSE 'Unknown' + CAST(s.RIGHTS AS NVARCHAR(10))
)


SELECT 
(Select p.object_name From DSSMDOBJINFO p Where p.object_id = o.project_id ) PROJECT

,dbo.fn_UniqueidentifierToCharMSTR(o.OBJECT_ID) GUID
,o.OBJECT_NAME
,d.FOLDER
,ISNULL(ot.NAME, o.OBJECT_TYPE) OBJ_TYPE

--...



FROM DSSMDOBJINFO o  -- MSTR Object
					
JOIN DIR d ON o.OBJECT_ID = d.OBJECT_ID AND d.PROJECT_ID = o.PROJECT_ID
LEFT JOIN OBJTYPETEXT ot ON ot.ID = o.OBJECT_TYPE

--< if you need security > 
/*JOIN DSSMDOBJSECU s  --security mapping
	ON s.OBJECT_ID = o.OBJECT_ID AND s.PROJECT_ID = o.PROJECT_ID
JOIN DSSMDOBJINFO t  -- MSTR trusted user/group
	ON s.TRUST_ID = t.OBJECT_ID --AND t.PROJECT_ID = o.PROJECT_ID --Users and groups dont use Project the same way		
LEFT JOIN RIGHTSTEXT r ON r.RIGHTS = s.RIGHTS
--</>*/

WHERE 
o.PROJECT_ID = (Select p.object_id From DSSMDOBJINFO p Where p.OBJECT_NAME = @Project AND p.OBJECT_TYPE = 32)

